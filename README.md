# Bank API

## Project Description
BasicBank API is a backend HTTP API designed for a fake financial institution, offering core banking functionalities. This API allows bank employees to create customer accounts, manage multiple bank accounts, perform transfers between accounts, and retrieve account balances and transaction histories. It is designed to be consumed by multiple frontends (web, iOS, Android, etc.).

## Features
- **Customer Management**: Create and manage customers.
- **Account Management**: Create new bank accounts with an initial deposit, manage multiple accounts for a single customer.
- **Transfers**: Transfer funds between any two accounts, including those owned by different customers.
- **Balance Retrieval**: Retrieve the current balance of any account.
- **Transaction History**: Retrieve the transfer history for any account.

## Enhancements and Additional Efforts
To ensure this project meets high standards, the following additional efforts were made:

- **End-to-End Testing**: Comprehensive end-to-end tests were written to ensure the full functionality of the API. This includes creating customers, accounts, making transfers, and retrieving account information and transfer history.
- **UUID Handling**: Switched to using UUIDs for unique identification of customers and accounts, ensuring a more robust and scalable approach.
- **Property-Based Testing**: Used Hypothesis for property-based testing, ensuring a wide range of inputs are tested, which helps in identifying edge cases and improving the robustness of the API.
- **Dependency Management with Poetry**: Managed dependencies using Poetry for a more streamlined and modern approach to Python project management.

# Project Directory Structure

```markdown
BasicBank/
├── app/
│   ├── __init__.py                
│   ├── api/
│   │   ├── __init__.py            
│   │   ├── endpoints/
│   │   │   ├── __init__.py        
│   │   │   ├── account.py         # Account-related API endpoints
│   │   │   ├── customer.py        # Customer-related API endpoints
│   │   │   ├── transfer.py        # Transfer-related API endpoints
│   │   ├── api.py              # Main router combining all endpoint routers
│   ├── crud/
│   │   ├── __init__.py            
│   │   ├── account.py             # CRUD operations for accounts
│   │   ├── customer.py            # CRUD operations for customers
│   │   ├── transfer.py            # CRUD operations for transfers
│   ├── database.py                # Database setup and session management
│   ├── main.py                    # Entry point for the FastAPI application
│   ├── models/
│   │   ├── __init__.py            
│   │   ├── models.py             # Database models
│   ├── schemas/
│   │   ├── __init__.py            
│   │   ├── schemas.py             # Pydantic schemas
├── dev-env/
│   ├── postgres_compose.yml       # Docker Compose configuration for local PostgreSQL setup
├── tests/
│   ├── __init__.py                
│   ├── end2end/
│   │   ├── __init__.py            
│   │   ├── test_api.py            # End-to-end tests for the API
│   ├── unit/
│   │   ├── __init__.py            
│   │   ├── test_crud.py           # Unit tests for CRUD operations
│   │   ├── test_models.py         # Unit tests for models
│   │   ├── test_schemas.py        # Unit tests for schemas
├── .env                           # Environment variables for local development
├── .gitignore                     # Git ignore file
├── Dockerfile                     # Dockerfile for containerizing the application
├── poetry.lock                    # Lock file generated by Poetry to ensure deterministic builds
├── pyproject.toml                 # Project configuration file for Poetry
└── README.md                      # Project README file
```


## Setup

1. Clone the repository:
   ```
   git clone https://github.com/flak153/BasicBank.git
   cd bank-api
   ```

2. Install Poetry if you haven't already:
   ```
   pip install poetry
   ```

3. Install the project dependencies:
   ```
   poetry install
   ```

4. Start the local PostgreSQL database:
   ```
   docker-compose -f dev-env/postgres_compose.yml up -d
   ```

## Running the application

1. Activate the Poetry virtual environment:
   ```
   poetry shell
   ```

2. Run the FastAPI application:
   ```
   uvicorn app.main:app --reload
   ```

The API will be available at `http://localhost:8000`.

## API Documentation

Once the application is running, you can access the interactive API documentation at `http://localhost:8000/docs`.

## API Endpoints

### Customer Endpoints

- **Create Customer**
  - **Endpoint**: `POST /customers/`
  - **Request Body**:
    ```json
    {
      "name": "John Doe"
    }
    ```
  - **Response**:
    ```json
    {
      "id": "uuid",
      "name": "John Doe"
    }
    ```

- **Get Customer**
  - **Endpoint**: `GET /customers/{customer_id}`
  - **Response**:
    ```json
    {
      "id": "uuid",
      "name": "John Doe"
    }
    ```

### Account Endpoints

- **Create Account**
  - **Endpoint**: `POST /accounts/`
  - **Request Body**:
    ```json
    {
      "customer_id": "uuid",
      "balance": 100.0
    }
    ```
  - **Response**:
    ```json
    {
      "id": "uuid",
      "customer_id": "uuid",
      "balance": 100.0
    }
    ```

- **Get Account**
  - **Endpoint**: `GET /accounts/{account_id}`
  - **Response**:
    ```json
    {
      "id": "uuid",
      "customer_id": "uuid",
      "balance": 100.0
    }
    ```

- **Get Account Balance**
  - **Endpoint**: `GET /accounts/{account_id}/balance`
  - **Response**:
    ```json
    {
      "balance": 100.0
    }
    ```

### Transfer Endpoints

- **Create Transfer**
  - **Endpoint**: `POST /transfers/`
  - **Request Body**:
    ```json
    {
      "from_account_id": "uuid",
      "to_account_id": "uuid",
      "amount": 50.0
    }
    ```
  - **Response**:
    ```json
    {
      "id": "uuid",
      "from_account_id": "uuid",
      "to_account_id": "uuid",
      "amount": 50.0
    }
    ```

- **Get Transfer**
  - **Endpoint**: `GET /transfers/{transfer_id}`
  - **Response**:
    ```json
    {
      "id": "uuid",
      "from_account_id": "uuid",
      "to_account_id": "uuid",
      "amount": 50.0
    }
    ```

- **Get Account Transfers**
  - **Endpoint**: `GET /transfers/account/{account_id}`
  - **Response**:
    ```json
    [
      {
        "id": "uuid",
        "from_account_id": "uuid",
        "to_account_id": "uuid",
        "amount": 50.0
      },
      ...
    ]
    ```

## Testing

To run the tests, use the following command:

```
pytest
```

## Stopping the database

When you're done, you can stop the PostgreSQL container with:

```
docker-compose -f dev-env/postgres_compose.yml down
```

## License

This project is licensed under the MIT License.
